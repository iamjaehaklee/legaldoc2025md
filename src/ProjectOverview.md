# LegalEditor 프로젝트 개요

## 1. 개요
### 1.1 프로젝트 소개
LegalEditor는 법률문서 작성을 위한 웹서비스로, 법률문서 작성 및 검토에 특화된 기능을 포함합니다.

---

### 1.2 프로젝트 목표 (보완版)
  - **직관적이고 효율적인 문서 편집/검토 환경 제공**: 사용자가 법률문서를 쉽게 작성하고 검토할 수 있는 환경을 제공하며, Plate.js 기반의 리치 텍스트 에디터와 파일뷰어, 법령/판례 뷰어를 통합하여 작업 흐름을 간소화.
  - **AI LLM 및 AI Agent를 활용한 실시간 지원과 생산성 향상**: OpenAI GPT-4o와 같은 AI LLM 및 AI Agent를 통해 문서 생성, 법적 리스크 검토, 사용자 질문 응답, 지시 수행을 실시간으로 지원하며, Ask/Write/Review 모드를 통해 사용자의 다양한 요구를 충족.
  - **문서 관리, 검색, 주석 기능의 고도화**: Upstage AI OCR로 업로드된 파일에서 텍스트를 추출하고, Qdrant RAG를 활용한 키워드/문맥 기반 검색으로 파일, 법령, 판례 등을 빠르게 탐색 가능하게 하며, 주석 관리로 협업과 검토 효율성을 극대화.
  - **국가법령정보센터 Open API를 통한 법률 자원 활용**: 법령과 판례를 실시간으로 검색하고 인용할 수 있는 기능을 제공하여, 법률문서 작성 시 신뢰성과 정확성을 높이고,  손쉽게 삽입 가능.
  - **프로젝트별 문서/증거 관리 및 협업 최적화**: Supabase Storage를 활용한 파일 관리와 트리 구조의 왼쪽사이드바로 프로젝트 데이터를 체계적으로 정리하며, Owner, Admin, Editor 등 역할 기반 협업과 알림 시스템으로 팀 작업의 효율성을 높임.
  - **AI 기반 자동화와 추천으로 작업 효율성 극대화**: 파일 업로드 시 요지 및 태그 자동 생성, 검색 시 AI 추천 결과 제공, 문서 편집 중 실시간 조항/법령 제안 등 AI 기반 기능을 통해 반복 작업을 줄이고 생산성을 높임.
  - **프로젝트 목표 설정 및 분석으로 전략적 법률문서 작성과 리스크 관리**: 프로젝트분석 탭을 통해 목표(Goal), 주장(Claim), 사실(Fact)을 계층적으로 관리하고, AI가 중립성 검증과 리스크 경고를 제공함으로써 법적 전략 수립과 문서 작성의 정합성을 강화.
 
---

## 2. 주요 기능

### 2.1 프로젝트 관리 
- **참여자 역할**: Owner, Admin, Editor, Commentator, Viewer.
- **협업**: 초대 수락/거절, 유료 플랜 검증, 결제 중단 처리, AI 권한 체계, 알림 시스템.

### 2.2 프로젝트 내 화면 구조
- **프로젝트 네비게이션 바** (`ProjectNavigationBarComponent.tsx`): 프로젝트 선택 (`ProjectSelectionDropdownComponent.tsx`), "메인 내비게이션 탭" (`MainNavigationTabsComponent.tsx`) (워크스페이스, 프로젝트분석, 채팅), 참여자 관리 (`MemberManagementPanelComponent.tsx`), 검색 필드 (`GlobalSearchFieldComponent.tsx`)
- **왼쪽사이드바 : 프로젝트데이터(ProjectData) 네비게이터** (`ProjectLeftSidebarComponent.tsx`)
- **메인화면** (`ProjectMainAreaComponent.tsx`)
  1. 워크스페이스스크린 (`WorkspaceScreen.tsx`): 각 문서 에디터 탭스크린들, 각 파일뷰어 탭스크린들, 각 법령/판례 뷰어 탭스크린 등 여러 개의 탭스크린들
  2. 프로젝트분석스크린 (`ProjectAnalysisScreen.tsx`)
  3. 채팅스크린 (`ChatScreen.tsx`)
- **오른쪽사이드바 : AI Agent** (`ProjectRightSidebarComponent.tsx`): 

### 2.3 프로젝트 내 파일자료 관리
- **업로드/관리**: Supabase Storage 활용. 왼쪽사이드바에 트리 구조로 프로젝트데이터(ProjectData, 파일 포함) 관리.
- **OCR**: Upstage AI로 PDF, 이미지 등의 텍스트 추출. Supabase 및 Qdrant 저장. 페이지별 기준 및 문단별 기준 각각 저장. 
- **요지 및 태그 생성**: 파일 업로드시 핵심요지, 키워드 태그 추출하여 저장. 
- **검색**: 
  - 제목 및 내용 일치 검색은 물론, Qdrant RAG로 키워드/문맥 기반 검색. 
  - AI 자동 추천 검색결과 포함. 
  - 문서편집기, 파일뷰어, 법령/판례 뷰어는 물론, 아래 인용 가능한 곳에서도 (인용을 위해) 모두 검색 가능. 
  - 검색 모달에서는, 검색된 파일목록은 물론, 해당 파일의 내용 미리보기 및 관련성 높은 내용 하이라이트 표시도 같은 화면에서 제공.
- **인용**: AI Agent 내, 문서 내, 댓글 내, 프로젝트분석 내, 채팅 내, 멘션드롭다운 및 멘션인라인칩 등으로 멘션 가능. 
- **주석**: pdf-annotate.js로 주석 삽입/관리. **파일프리뷰모달** 및 **파일뷰스크린**에서 모두 주석 쓰기/보기가 가능함.
- **파일프리뷰모달**: 마우스 hover 를 하면 파일 중 문맥관련성 높은 내용 부분이 모달 (`FilePreviewModalComponent.tsx`)로 보임. 
- **파일뷰스크린**: 파일 내용을 워크스페이스스크린 (`WorkspaceScreen.tsx`)의 탭스크린인 파일뷰스크린(`FileViewScreen.tsx`)으로 볼 수 있음.  

### 2.4 프로젝트 내 법령/판례 관리
- **법령/판례 API 검색**: 국가법령정보센터 Open API 활용, Supabase 및 Qdrant 저장. 
- **법령/판례 RAG 검색**: 저장된 법령/판례는 Qdrant RAG로 키워드/문맥 기반 검색.
- **인용**: AI Agent 내, 문서 내, 댓글 내, 프로젝트분석 내, 채팅 내, 멘션드롭다운 및 멘션인라인칩 등으로 멘션 가능. 
- **주석**: 법령/판례의 조항이나 문단을 특정하여 주석 삽입/관리. **법령프리뷰어, 판례프리뷰어** 및 **법령뷰어, 판례뷰어**에서 모두 주석 쓰기/보기가 가능함.
- **법령프리뷰모달, 판례프리뷰모달**: 마우스 hover 시 법령 (`LawPreviewModalComponent.tsx`)이나 판례 (`PrecedentPreviewModalComponent.tsx`) 미리보기 모달.
- **법령뷰스크린, 판례뷰스크린**: 법령 또는 판례 내용을 워크스페이스스크린 (`WorkspaceScreen.tsx`)의 탭스크린인 법령뷰스크린 (`LawViewScreen.tsx`)이나 판례 (`PrecedentViewScreen.tsx`) 으로 볼 수 있음.  

      -------

      # [프로젝트데이터(ProjectData)]
      ## [작성문서(EditingDocument)]
      - 유저가 이 앱에서 작성하였거나 작성 중인 문서

      ## [프로젝트참고자료(ProjectReference)]
      ### 증거자료 (Evidence) : 이 프로젝트의 사실관계를 뒷받침하는 자료들임. 우리가 제출할 수도 있고 상대방이 제출할 수도 있음. ('우리측 증거자료', '상대방 증거자료')
      ### 주장서류 (ClaimingDocument) : 우리측 및 상대측에서 주장을 하는 서면. 우리가 제출한 소장, 준비서면, 참고서면 등, 상대방이 제출한 소장, 준비서면, 참고서면 등.
      ### 법령 (Law) : 현재 효력이 있는 강제규범으로서의 법률
      ### 판례 (Precedent) : 법령의 해석 및 적용례로서, 사실상 강제규범으로 작용하는 선례
      ### 참고자료 (ConsiderableDocument) : 법령이나 판례는 아니지만, 사건에 참고할 만한 전거자료
      ### 프로젝트최종결정문 (ProjectFinalJudgement) : 분쟁 결과 법원이나 검찰, 행정기관 등이 종국적으로 내린 판단. 일단 내려진 판정 결과이므로 이것에 대해 어떻게 다툴 것인지 검토해야 함.  

      - 이 중 증거자료, 주장서류, 참고자료, 프로젝트최종결정문은 '파일'의 형태임. 즉, PDF, DOCX, PPTX, EXLS, HWP, 영상, 음성, 각종 이미지 등.

      -------

### 2.5 프로젝트 내 문서 편집 및 관리
- **기능**: Plate.js 기반 리치 텍스트 에디터로 법률문서 작성.
- **문서 편집기**: 전문 워드 프로세서 기능 (서식, 템플릿, 자동 번호 매김), 증거자료 및 법령 확인/인용 용이.
- **파일, 법령/판례 검색 및 인용**: 텍스트 에디터에서 '@'을 입력하여, 컨텍스트 메뉴 호출. 위 '프로젝트참고자료(ProjectReference)[=파일들, 법령/판례]'들의 명칭을 직접 타이핑하여 입력하거나, 검색 모달을 띄워서 가장 연관성 있는 것을 선택할 수 있음. 
- **동시 편집**: 프로젝트 멤버들 중 Edit 권한이 있는 멤버들은 동시 작업 가능.
- **내보내기** : PDF, DOCX
- **AI Agent 활용**
  - 현재 문서 에디터상의 커서가 위치한 곳의 앞뒤 맥락을 AI Agent에게 보내거나, 문서 에디터상에서 블록 지정하여 AI Agent에게 보낼 수 있음. 
  - AI Agent가 문서 내용을 수정한 경우, 승인/거부 선택할 수 있음. 또한 승인/거부를 선택하지 않은 채로 다시 AI Agent에게 그 맥락으로 질문/작성지시/리뷰 지시할 수 있음.
  
### 2.6 AI Agent

- **Ask 모드**:
  - 사용자 질문에 프로젝트 데이터 기반 답변 (예: "손해배상 조항 필요 여부", "이 주장에 인용할 만한 증거자료나 판례").
  - 수정은 제외.
- **Write 모드**:
  - 문서 생성/수정 지시 수행 (예: "비밀유지조항 추가", "상고이유서 작성").
  - 프로젝트분석 수정, 증거자료 댓글 제안.
- **Review 모드**:
  - 법적 리스크, 오류, 개선 사항 피드백.
- **실시간 지원 (추후 예정)**:
  - 조항, 문구, 법령/판례 실시간 제안.
  - 문맥 기반 자동 완성 및 템플릿 추천.

### 2.7 프로젝트분석
- **구성**: '우리측 입장 분석', '상대방측 입장 분석(및 우리측의 대응 전략)', '중립적 사실관계 분석' 3개 서브탭  
- **기능**: 
  1. 목표(Goal), 주장(Claim), 사실(Fact),프로젝트데이터(ProjectData) 계층 관리 + AI 실시간 피드백/수정  
  2. AI Agent가 검색 및 추천, 문서 편집기 작업함서도, 프로젝트분석 내용을 참고.
  3. 문서편집기, 파일뷰어, 채팅 등 프로젝트 전체에서, 위 프로젝트 분석 항목들에 대해 쉽게 항목 추가.
- **시각화**: 트리, 필터링, 정합성/모호성 검증(경고 메시지)  
- **AI 지원**: 목표/주장 분류, 검색 및 추천, 중립성 검증, 사실 세분화 제안  
- **인용**: AI Agent 내, 문서 내, 댓글 내, 프로젝트분석 내, 채팅 내,  `[@ 목표/주장/사실]` 형식
- **미리보기**: 마우스 hover 시 목표/주장/사실 미리보기 모달 (`GoalClaimFactPreviewModalComponent.tsx`)

      -------

      ## [상대방(Opponent)]
      - 여기서 상대방은 민사인 경우 개인 또는 법인, 형사인 경우 수사기관(검찰, 경찰), 조세인 경우 과세관청, 행정처분/행정조사인 경우 행정청, 금융조사인 경우 금융감독원, 공정거래조사/처분인 경우 공정거래위원회 등임.

      - **목표(Goal)**: 법률 업무에서 목표는 다음 중 하나를 의미합니다:
        1. 상대방으로부터 금전, 부동산 인도, 물건 명도, 권리 이전 등 구체적인 것을 얻어내는 것
        2. 상대방의 금전, 인도, 권리 이전 등 소송상의, 소송외의 청구에 대해 방어하는 것
        3. 상대방과 협상하여 유리한 조건의 계약/합의 체결을 달성하는 것
        4. 법원/검찰/경찰/행정청/과세당국/중재원 등 법적판단기관으로부터 유리한 결정을 받는 것
        5. 예상치 못한 과다한 조세 부과를 당하거나, 세무조사를 당하는 것을 예방하는 것
        6. 장래에 불특정인으로부터 소송, 고소, 청구, 언론폭로 등을 당하거나, 수사기관/행정청/과세당국 등으로부터 조사를 당할 리스크를 예방하는 것
        
        목표는 서로 중복되면 안 되며, 다른 목표들과 목적/수단 관계에 있어서도 안 됩니다. 목표는 궁극적으로 이루고자 하는 최종 결과물입니다.

      - **주장(Claim)**: 주장은 목표를 달성하기 위한 구체적인 법적 논점이나 입장입니다. 각 주장은 하나 이상의 목표를 지원하며, 사실(Fact)과 프로젝트참고자료(ProjectReference) 중 법령, 판례, 프로젝트최종결정문, 참고자료에 의해 뒷받침되어야 합니다. 예를 들어, 손해배상금을 받는 것이 목표라면, "상대방의 계약 위반으로 손해가 발생했다"와 같은 내용이 주장이 됩니다.

      - **사실(Fact)**: 사실은 프로젝트참고자료(ProjectReference) 중 증거자료, 주장서류에 의해 직접적으로 뒷받침되는, 6하원칙(가급적 달성하고자 하며, 주어, 일시, 목적어, 술어는 가급적 포함)에 따른 추출내용입니다. 사실은 계층적 구조를 가질 수 있으며, 포괄적/추상적/모호한 사실은 보다 구체적이고 세분화된 하위 사실들로 구성될 수 있습니다. 예를 들어, "을순이는 계약을 위반했다"라는 포괄적 사실은 "을순이는 2024. 4. 1. 16:23 부동산매매계약 잔금 100만원을 입금받았다", "을순이는 2024. 4. 1. 계약에서 정한 잔금지급기한을 준수하지 않았다" 등의 구체적인 하위 사실들로 세분화될 수 있습니다.

      -------


### 2.8 채팅
- **기능**: 실시간 채팅, 프로젝트데이터(ProjectData), 프로젝트분석 항목[목표(Goal), 주장(Claim), 사실(Fact)] 인용 가능.


---

## 3. 타겟 사용자
- 법률 전문가 (변호사, 법무사 등).
- 기업 법무팀.
- 법률문서 작성이 필요한 일반 사용자.

---

## 4. 기술 스택
### 4.1 프론트엔드
- React 18, TypeScript 5.x, Plate.js, react-pdf, pdf-annotate.js.

### 4.2 백엔드
- Next.js 14, Supabase (DB/Storage), Drizzle ORM, Qdrant, FastAPI (Python 서버).

### 4.3 AI
- OpenAI GPT-4o (문서 생성, AI Agent), Upstage AI (OCR).

### 4.4 기타
- 국가법령정보센터 Open API (법령/판례 검색).
- Supabase Realtime (채팅).
- jsPDF (PDF 내보내기).

