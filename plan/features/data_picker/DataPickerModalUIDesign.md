# 이 모달이 호출되는 맥락
- 문서 에디터에서 문서를 작성하다가 유저가 작성 중인 문단 또는 블록 선택한 텍스트와 관련된 자료를 찾아, 해당 문서에 인용하려고 하는 경우 (또는 그냥 자료를 찾아 인용하려는 경우)
- 문서 에디터, 파일뷰어, 법령뷰어, 판례뷰어에서 댓글쓰기를 하다가, 이와 관련된 자료를 찾아, 그 댓글에서 해당 자료를 인용하려고 하는 경우 (또는 그냥 자료를 찾아 인용하려는 경우)
- 프로젝트분석화면에서 목표(Goal)이나 주장(Claim)을 선택한 상황에서, 이와 관련된 자료를 찾아, 주장을 뒷받침하는 증거자료로 추가하려고 하는 경우 (또는 그냥 자료를 찾아 인용하려는 경우)
- 채팅 중에 직전의 대화 맥락에 맞는 자료를 찾아, 자료를 채팅에서 인용하려고 하는 경우 (또는 그냥 자료를 찾아 인용하려는 경우)

# 용어 정의

## 기본 용어
- 자료(Document): 프로젝트에서 다루는 모든 종류의 문서나 파일
- 문단(Paragraph): 자료 내에서 선택 가능한 최소 단위의 텍스트 블록
- 선택(Selection): 자료의 특정 문단을 지정하는 행위
- 인용(Citation): 선택한 자료를 현재 작업 중인 문서에 참조하는 행위

## UI 모드
- 일반 모드(Normal Mode): 자료 검색과 프리뷰가 가능한 기본 상태
- 선택 모드(Selection Mode): 자료의 특정 문단을 선택할 수 있는 상태

## UI 요소
- 칩(Chip): 선택된 자료의 정보(자료명/페이지/문단번호)를 표시하는 UI 요소
- 선택 오버레이(Selection Overlay): 선택 모드에서 문단 위에 표시되는 UI 레이어
- 하이라이트(Highlight): 검색어나 선택된 영역을 강조 표시하는 것

## 자료 종류
- 작성문서: 사용자가 작성 중이거나 작성한 문서
- 증거자료: 사실관계 입증을 위한 자료
- 주장서류: 소장, 준비서면 등의 법적 문서
- 법령: 현행 법률 조문
- 판례: 법원의 판결례
- 참고자료: 기타 참고할 만한 자료
- 프로젝트최종결정문: 최종 판단이 담긴 문서

상단의 검색창, 하단메인영역의 좌측은 프로젝트데이터목록(상단에는 검색(제목 및 내용 일치)결과데이터목록, 하단에는 컨텍스트에 맞는 AI추천자료목록), 우측은 좌측의 프로젝트데이터목록에서 선택된 자료의 내용(관련성 있는 내용에는 하이라이트 표시하고, 최초에 볼 때에는 그 부분부터 보여주기) 보여주기. 아래 데이터(자료)들을 모두 망라하여 검색하고 미리보고, 선택하는 위젯임.  

# 기능 개요
이 모달은 프로젝트 내의 모든 자료를 효율적으로 검색하고, 관련성이 높은 자료를 AI가 추천하며, 선택한 자료의 내용을 즉시 확인할 수 있는 통합 데이터 피커입니다. 사용자의 현재 작업 중인 자료의 컨텍스트를 이해하고 관련된 자료를 즉시 찾아 인용할 수 있도록 도와줍니다.

# 주요 기능 및 사용자 상호작용

## 1. 검색 및 필터링 시스템
### 실시간 검색
- 사용자가 타이핑을 시작하면 0.5초 디바운스 후 검색 시작
- 검색은 자료의 제목, 내용, 메타데이터를 포함한 전문 검색
- 검색어 하이라이트로 매칭된 부분 강조

### 컨텍스트 기반 자동완성
- 현재 작업 중인 자료의 맥락을 고려한 검색어 추천
- 최근 검색 기록 기반 추천
- 자주 사용되는 법률 용어 자동 완성

### 스마트 필터링
- 자료 종류별 필터링으로 검색 범위 최적화
- 필터 조합 가능 (예: 증거자료 중 우리측 자료만 보기)
- 최근 사용한 필터 조합 저장 기능

## 2. AI 추천 시스템
### 컨텍스트 인식 추천
- 현재 작업 중인 자료 내용 분석
- 관련 법령, 판례, 증거자료 자동 추천
- 추천 이유 표시 (예: "현재 문단과 90% 유사")

## 3. 자료 프리뷰 및 인용
### 스마트 프리뷰
- 관련 내용 자동 스크롤 및 하이라이트
- 검색어 주변 컨텍스트 미리보기
- 멀티 포맷 지원 (PDF, Word, 이미지 등)

### 인용 및 참조
- 드래그 앤 드롭으로 즉시 인용
- 자동 각주/미주 생성
- 인용 스타일 자동 적용

## 4. 사용자 경험 최적화
### 작업 기록
- 최근 본 문서 히스토리
- 자주 사용하는 문서 즐겨찾기
- 검색 패턴 학습 및 개인화

### 키보드 단축키
- `Ctrl + F`: 검색창 포커스
- `Ctrl + E`: 필터 토글
- `↑↓`: 검색 결과 네비게이션
- `Enter`: 문서 선택
- `Esc`: 모달 닫기

### 접근성
- 스크린 리더 호환
- 키보드 네비게이션 완벽 지원
- 고대비 모드 지원

# UI 상세 명세

## 1. 모달 기본 설정
- 크기: 화면의 90% (최소 너비 1024px, 최대 너비 1600px)
- 높이: 화면의 80% (최소 높이 768px)
- 배경색: #FFFFFF
- 그림자: 0 4px 12px rgba(0, 0, 0, 0.15)
- 테두리 반경: 8px
- 패딩: 24px

## 2. 검색 영역 (상단)
### 2.1 검색 필터 드롭다운
- 위치: 검색창 좌측
- 너비: 160px
- 높이: 40px
- 테두리: 1px solid #E5E7EB
- 배경색: #F9FAFB
- 아이콘: 우측에 화살표 아이콘
- 옵션 목록:
  - 전체
  - 작성문서
  - 증거자료
  - 주장서류
  - 법령
  - 판례
  - 참고자료
  - 프로젝트최종결정문

### 2.2 검색창
- 너비: 전체 너비의 80% - 160px (필터 드롭다운 너비)
- 높이: 40px
- 테두리: 1px solid #E5E7EB
- 포커스 시 테두리: 2px solid #2563EB
- 폰트 크기: 14px
- 패딩: 좌우 12px
- 플레이스홀더: "검색어를 입력하세요..."

### 2.3 자동완성 기능
- 최대 표시 항목: 5개
- 배경색: #FFFFFF
- 테두리: 1px solid #E5E7EB
- 그림자: 0 2px 8px rgba(0, 0, 0, 0.1)
- 각 항목 높이: 36px
- 호버 시 배경색: #F3F4F6

### 2.4 검색 버튼
- 너비: 80px
- 높이: 40px
- 배경색: #2563EB
- 호버 시 배경색: #1D4ED8
- 텍스트 색상: #FFFFFF
- 테두리 반경: 4px

## 3. 메인 영역 (하단)
### 3.1 좌측 패널 (전체 너비의 20%)
#### 탭 바
- 높이: 48px
- 배경색: #F9FAFB
- 탭 테두리 하단: 2px solid #E5E7EB
- 활성 탭 테두리 하단: 2px solid #2563EB
- 탭 텍스트 색상: #6B7280
- 활성 탭 텍스트 색상: #2563EB

#### 정렬 컨트롤
- 높이: 40px
- 배경색: #FFFFFF
- 드롭다운 스타일: 검색 필터와 동일

#### 문서 리스트
- 각 항목 높이: 72px
- 패딩: 12px
- 테두리 하단: 1px solid #E5E7EB
- 호버 시 배경색: #F9FAFB
- 선택 시 배경색: #EFF6FF
- 문서 아이콘: 24x24px
- 제목 폰트 크기: 14px
- 메타데이터 폰트 크기: 12px
- 관련도 점수: 원형 배지 스타일 (배경색: #E5E7EB)

### 3.2 우측 패널 (전체 너비의 80%)
#### 프리뷰 헤더
- 높이: 56px
- 배경색: #F9FAFB
- 테두리 하단: 1px solid #E5E7EB
- 제목 폰트 크기: 16px
- 제목 폰트 웨이트: 600

#### 컨트롤 버튼
- 크기: 36x36px
- 아이콘 크기: 20x20px
- 테두리: 1px solid #E5E7EB
- 호버 시 배경색: #F3F4F6
- 간격: 8px

#### 문서 프리뷰 영역
- 패딩: 24px
- 배경색: #FFFFFF
- 줌 레벨: 100% (기본값), 75%, 125%, 150%
- 하이라이트 배경색: #FEF3C7
- 스크롤바 스타일:
  - 너비: 8px
  - 배경색: #F3F4F6
  - 썸네일 색상: #D1D5DB

## 4. 반응형 동작
### 데스크톱 (1024px 이상)
- 기본 레이아웃 유지

### 태블릿 (768px - 1023px)
- 좌측 패널: 30%
- 우측 패널: 70%
- 검색창 너비: 70%

### 모바일 (768px 미만)
- 단일 컬럼 레이아웃으로 전환
- 패널 간 전환을 위한 토글 버튼 추가
- 검색창 너비: 100%
- 필터는 드롭다운 메뉴로 변경

# 상호작용 플로우

## 1. 검색 시작
1. 모달 오픈 시 검색창에 자동 포커스
2. 타이핑 시작하면 자동완성 표시
3. 필터 선택 시 실시간 결과 업데이트

## 2. 결과 탐색
1. 검색 결과는 관련도 순으로 정렬
2. 스크롤 시 무한 로딩으로 추가 결과 로드
3. 항목 호버 시 미리보기 툴팁 표시

## 3. 문서 선택
1. 항목 클릭 시 우측 패널에 전체 내용 로드
2. 여러 개의 파일 (및 해당 부분) 선택 가능. 
3. '현재 보고 있는 자료 선택하기' 버튼이 있고, 그것을 누르면 그 파일의 어느 부분을 인용할 것인지 우측 패널에서 선택하기 모드 진입. 마우스 호버를 하면 해당 문단에 네모박스가 보여지고, 우상단에 체크박스가 있어. 여러 개의 체크박스 클릭이 가능함. 이것을 마치면, 하단에 Chip 의 형태로, 자료명/페이지/문단번호가 추가됨. 이와 같이 1개 또는 그 이상의 자료들을 선택한 후 선택완료 버튼을 누르면 모달 종료 
3. 드래그 앤 드롭으로 직접 인용 가능

## 4. AI 추천 활용
1. 작업 중인 문서 분석
2. 관련 자료 실시간 추천
3. 추천 자료 클릭 시 관련성 점수와 이유 표시

# 위젯 트리 구조
```
DataPickerModal (통합 데이터 선택 모달)
├── ModalHeader (모달 상단부)
│   └── CloseButton (닫기 버튼)
├── SearchSection (검색 영역)
│   ├── FilterDropdown (필터 드롭다운)
│   │   ├── FilterIcon (필터 아이콘)
│   │   ├── SelectedFilter (선택된 필터)
│   │   └── FilterOptions (필터 옵션 목록)
│   │       └── FilterOption[] (개별 필터 옵션)
│   ├── SearchTextField (검색 입력창)
│   │   ├── SearchIcon (검색 아이콘)
│   │   └── AutocompletePopup (자동완성 팝업)
│   │       ├── RecentSearches (최근 검색어)
│   │       ├── ContextualSuggestions (컨텍스트 기반 추천)
│   │       └── LegalTermSuggestions (법률용어 추천)
│   └── SearchButton (검색 버튼)
├── MainContent (메인 콘텐츠 영역)
│   ├── LeftPanel (좌측 패널 - 20%)
│   │   ├── TabBar (탭 바)
│   │   │   ├── SearchResultsTab (검색 결과 탭)
│   │   │   └── AIRecommendationsTab (AI 추천 탭)
│   │   ├── SortingControls (정렬 컨트롤)
│   │   │   ├── SortByDropdown (정렬 기준 선택)
│   │   │   └── OrderToggle (정렬 순서 토글)
│   │   └── DocumentList (문서 목록)
│   │       └── DocumentListItem[] (문서 항목)
│   │           ├── DocumentIcon (문서 종류 아이콘)
│   │           ├── DocumentTitle (문서 제목)
│   │           ├── DocumentMetadata (문서 메타데이터)
│   │           │   ├── LastModified (최종 수정일)
│   │           │   └── DocumentType (문서 종류)
│   │           └── RelevanceScore (관련도 점수)
│   └── RightPanel (우측 패널 - 80%)
│       ├── PreviewHeader (프리뷰 헤더)
│       │   ├── DocumentTitle (문서 제목)
│       │   ├── SelectionModeControls (선택 모드 컨트롤)
│       │   │   ├── SelectCurrentDocumentButton (현재 자료 선택 버튼)
│       │   │   └── CancelSelectionModeButton (선택 모드 취소 버튼)
│       │   └── ControlButtons (컨트롤 버튼)
│       │       ├── ZoomControls (확대/축소 컨트롤)
│       │       │   ├── ZoomInButton (확대 버튼)
│       │       │   ├── ZoomOutButton (축소 버튼)
│       │       │   └── ZoomResetButton (리셋 버튼)
│       │       ├── DownloadButton (다운로드 버튼)
│       │       └── SelectButton (선택 버튼)
│       └── DocumentPreview (문서 프리뷰)
│           ├── ParagraphSelectionOverlay[] (문단 선택 오버레이)
│           │   ├── HoverBox (호버 시 표시되는 네모박스)
│           │   └── SelectionCheckbox (문단 선택 체크박스)
│           ├── HighlightedContent (하이라이트된 내용)
│           └── ScrollIndicator (스크롤 위치 표시)
└── ModalFooter (모달 하단부)
    ├── SelectedItemsChips (선택된 항목 칩 목록)
    │   └── ItemChip[] (자료명/페이지/문단번호 칩)
    ├── StatusBar (상태 표시줄)
    │   ├── ResultCount (검색 결과 수)
    │   └── LoadingIndicator (로딩 표시)
    └── ActionButtons (작업 버튼)
        ├── CancelButton (취소 버튼)
        └── SelectButton (선택 확인 버튼)
```

# 위젯 설명

## 주요 컴포넌트 역할

### ModalHeader
- 모달의 상단부를 구성
- 닫기 버튼으로 모달을 종료할 수 있음

### SearchSection
- 검색 관련 모든 컴포넌트를 포함
- 필터, 검색창, 자동완성 기능을 통합 관리

### MainContent
- 좌측의 문서 목록과 우측의 프리뷰를 포함
- 화면 크기에 따라 레이아웃 동적 조정

### ModalFooter
- 전체 작업 상태 표시
- 최종 선택/취소 기능 제공

## 특수 기능 컴포넌트

### AutocompletePopup
- 검색어 입력 시 실시간 추천
- 3가지 타입의 추천 제공 (최근 검색어, 컨텍스트 기반, 법률용어)

### DocumentListItem
- 문서의 메타데이터와 관련도 표시
- 드래그 앤 드롭 소스로 작동

### DocumentPreview
- 선택된 문서의 실시간 프리뷰
- 선택 모드에서 문단별 호버 및 선택 UI 표시
- 하이라이트 및 스크롤 위치 관리
- 드래그 앤 드롭으로 직접 인용 가능

### SelectionModeControls
- 자료 선택 모드 관련 컨트롤 버튼들을 포함
- 선택 모드 진입/취소 기능 제공
- 선택 모드 상태에 따라 버튼 표시 전환
  - 일반 모드: '현재 자료 선택하기' 버튼만 표시
  - 선택 모드: '선택 모드 취소' 버튼 표시

### SelectCurrentDocumentButton
- 현재 보고 있는 자료의 특정 부분을 선택하는 모드로 전환
- 클릭 시 문단 선택 오버레이 활성화
- 선택 모드 진입 시 버튼이 비활성화되고 숨겨짐

### CancelSelectionModeButton
- 선택 모드를 취소하고 일반 모드로 복귀
- 선택 모드에서만 표시됨
- 클릭 시:
  - 현재 자료에서 새로 선택된 문단들의 체크박스만 해제
  - 현재 자료의 선택 오버레이 비활성화
  - 이전에 선택된 다른 자료들의 선택 내역(칩)은 유지
  - 일반 모드로 복귀

### ParagraphSelectionOverlay
- 문서 내 각 문단에 대한 선택 인터페이스
- 마우스 호버 시 문단 영역 표시
- 우상단 체크박스로 다중 선택 가능

### SelectedItemsChips
- 선택된 문단들을 칩 형태로 표시
- 각 칩은 자료명/페이지/문단번호 정보 포함
- 칩 클릭 시 해당 문단으로 스크롤
- 칩 삭제 버튼으로 개별 선택 해제 가능
- 여러 자료의 선택 내역을 독립적으로 관리
  - 자료 A의 선택 내역은 자료 B의 선택 모드 진입/취소에 영향받지 않음
  - 각 자료별로 선택된 문단 정보를 개별적으로 저장
  - 선택 모드 취소 시 현재 자료의 임시 선택 내역만 초기화

## 상태 관리 컴포넌트

### StatusBar
- 현재 검색 상태 표시
- 로딩 진행률 표시

### ControlButtons
- 문서 조작 관련 기능 제공
- 확대/축소, 다운로드, 선택 기능 통합