# 증거자료 관리 시나리오

## 시나리오 개요
형사 변호를 담당하는 신흥 변호사는 복잡한 사기 혐의 사건을 맡게 되었습니다. 이 사건에는 다양한 형태의 증거자료(계약서, 이메일, 기록문서, 사진 등)가 포함되어 있으며, 이를 효율적으로 관리하고 분석하여 의뢰인을 변호하기 위해 LegalEditor의 증거자료 관리 기능을 활용하고자 합니다.

## 사용자 여정

### 1. 증거자료 업로드 및 분류 [PASS]
- 신흥 변호사는 "김철수 사기 혐의 변호" 프로젝트를 생성합니다.
- 프로젝트 내 '증거자료' 탭으로 이동하여 '파일 업로드' 버튼을 클릭합니다.
- 일괄 업로드 기능을 사용하여 여러 증거자료를 동시에 업로드합니다:
  - 의뢰인과 피해자 간 거래 계약서 PDF 5개
  - 이메일 교환 내역 PDF 20개
  - 금융거래 내역서 스캔본 10개
  - 관련 현장 사진 15장
- 업로드 중 프로그레스 바가 표시되며, 대용량 파일 업로드 시 자동으로 최적화됩니다.
- 업로드 완료 후, 증거자료 목록에서 모든 파일을 확인합니다.
- '폴더 생성' 기능을 사용하여 "계약서", "이메일", "금융거래", "사진" 폴더를 만들고 해당 파일들을 각 폴더로 드래그하여 분류합니다.
- 각 증거자료에 태그(예: #핵심증거, #보조증거, #검토필요)를 추가하고, 중요도에 따라 별표 표시를 합니다.

### 2. OCR 처리 및 텍스트 추출 [TODO]
- 업로드한 PDF 파일들이 사이드바에 즉시 표시되며, 각 파일 옆에는 "OCR 처리 중" 아이콘이 표시됩니다.
- OCR 처리는 자동으로 백그라운드에서 진행되며, 이 동안에도 파일을 열어 내용을 확인할 수 있습니다.
- OCR 처리가 약 30초 후 완료되면 "OCR 처리 중" 아이콘이 "임베딩 중" 아이콘으로 변경됩니다.
- 임베딩까지 완료되면 Toast 메시지로 "파일명.pdf의 OCR 및 임베딩이 완료되었습니다"라는 알림이 표시됩니다.
- OCR 처리 완료 후에는 PDF 내 텍스트가 선택 가능하게 변경되어, 특정 텍스트를 드래그하여 선택할 수 있습니다.
- 'OCR 텍스트 보기' 버튼을 클릭하여 추출된 전체 텍스트를 사이드 패널에서 확인합니다.
- OCR 결과에서 특정 오류(숫자나 특수 문자 인식 오류)를 발견하고, 'OCR 텍스트 수정' 기능을 사용하여 해당 부분을 수정합니다.
- 모든 PDF 파일은 업로드 직후 자동으로 OCR 처리가 시작되므로, 별도의 OCR 명령 없이도 모든 파일이 처리됩니다.

### 3. PDF 주석 및 하이라이트 [TODO]
- OCR 처리된 계약서에서 사기 혐의와 관련된 핵심 조항을 발견합니다.
- PDF 뷰어의 하이라이트 도구를 선택하여 해당 조항을 노란색으로 하이라이트합니다.
- 하이라이트된 부분에 우클릭하여 '주석 추가' 메뉴를 선택합니다.
- 주석에 "이 조항은 의뢰인이 명확히 설명했으며, 사기 의도가 없었음을 증명하는 핵심 증거"라고 입력합니다.
- 다른 중요 부분에도 빨간색, 파란색 등 다양한 색상으로 하이라이트하고 관련 주석을 추가합니다.
- '주석 목록 보기' 버튼을 클릭하여 문서 내 모든 주석을 사이드 패널에서 확인합니다.
- 주석 목록에서 특정 주석을 클릭하면 PDF가 해당 위치로 자동 스크롤됩니다.
- '주석 내보내기' 기능을 사용하여 모든 주석을 별도의 문서로 저장합니다.

### 4. 증거자료 검색 및 필터링 [TODO]
- 증거자료가 많아지면서 특정 키워드가 포함된 문서를 찾을 필요가 생깁니다.
- 증거자료 탭을 누른 상태에서 나타나는 증거자료뷰어 화면의 상단의 검색창에 "대금 지급"이라는 키워드를 입력합니다. OCR 텍스트를 고려하여 검색합니다. 
- 검색 결과로 해당 키워드가 포함된 여러 문서가 드롭다운으로 표시됩니다.
- 검색 결과는 "관련도순"으로 관련도가 높은 것부터 정렬됩니다. 이 때 관련도를 고려함에 있어서는 OCR 내용, vector, 하이라이트된 부분, 주석이 달린 부분, 검색어와 가까운 목표나 주장에서 인용한 증거자료인지 여부도 고려합니다. 
- 태그 필터 기능을 사용하여 "계약서" 태그가 있는 문서만 표시하도록 설정합니다. 각각의 증거자료들은 OCR이 완료된 후 자동으로 5개씩의 태그가 부여된 상태였습니다. 
- 필터링된 결과에서 가장 관련성 높은 문서를 클릭하여 열람합니다. 여러 개를 열람할 수도 있으며 그 경우 증거자료 탭 메인화면에는 파일별로 탭이 열립니다. 새 탭을 추가해서 파일을 여는 것도 가능합니다.  
- 문서 내에서 검색어인 "대금 지급"이 하이라이트되어 있는 부분들을 확인합니다.

### 5. AI Agent를 통한 증거자료 검색 [TODO]
- 사건 내용이 복잡해지면서 특정 상황에 관련된 모든 증거를 찾아야 합니다.
- 증거자료 탭을 눌러 증거자료뷰어 화면이 나타난 상태에서 우측사이드바의 AI Agent 채팅창에 "철수가 지급을 약속했다는 증거"라는 자연어 쿼리를 입력합니다.
- AI Agent 가 ask mode라면 AI Agent 위젯의 결과내역에 의미적으로 관계되는 증거자료들 검색하는 로직과 검색결과를 표시. 만일 write mode 라고 하더라도, 위 쿼리는 무엇인가를 작성하겠다는 것이 아니라, 증거자료를 쿼리하겠다는 의도이므로, 그러한 해석을 하고, ask mode 와 동일하게 AI Agent 위젯의 결과내역에 의미적으로 관계되는 증거자료들 검색하는 로직과 검색결과를 표시.
- 각 검색 결과에는 관련성 점수와 함께 관련 부분이 발췌되어 표시됩니다.
- 검색 결과 중 하나를 클릭하여 문서를 열면, 시스템이 자동으로 관련 부분으로 스크롤합니다.
- '검색 히스토리' 기능을 통해 이전 검색 기록을 확인하고 반복 검색을 쉽게 수행합니다.

### 6. 증거자료 인용 및 문서 연결 [TODO]
- 변호 전략을 수립하기 위해 주요 증거자료를 기반으로 변론요지서를 작성하기로 합니다.
- 프로젝트 내에서 '새 문서 생성'을 클릭하고 "변론요지서"라는 제목의 문서를 생성합니다.
- 문서 작성 중 중요한 증거를 인용해야 하는 부분에서 '증거자료 인용' 버튼을 클릭합니다. (한편, 유저는 문서 작성 중 에디터에서 @을 타이핑하면 팝업메뉴가 뜨는데, 그 팝업메뉴 내에는 '증거자료 인용', '법령 & 판례 인용', '다음 내용 자동생성'이 떠서 선택 가능하므로, 이 방법도 사용 가능합니다. )
- 팝업된 증거자료 목록에서 앞서 주석을 추가한 계약서를 선택합니다.
- '특정 부분 인용' 옵션을 선택하고, 앞서 하이라이트한 부분을 선택합니다. 그리고 '인용 삽입' 버튼을 클릭합니다.
- 문서에 `[인용: 계약서A-p.3-하이라이트1]` 형태로 증거 인용이 삽입됩니다.
- 인용된 부분을 마우스 hover 하면 팝업 창으로 해당 증거자료의 인용 부분을 바로 확인할 수 있습니다.
- 추가로 여러 증거자료를 같은 방식으로 문서 내에 인용합니다.

### 7. 작성문서 버전 관리 [TODO]
- 새로운 증거자료가 발견되어 기존에 작성한 계약서의 업데이트된 버전을 생성해야 합니다.
- 이미 주석이 달린 계약서를 선택하고 '버전 생성' 버튼을 클릭합니다.
- 최초 버전은 1.0 입니다. 그것을 1.1로 할지, 2.0으로 할지 선택합니다. 이 시나리오에서 유저는 2.0을 선택했습니다. 
- 업로드가 완료되면 드롭다운 위젯에 "버전 2.0"으로 표시되며, 이전 버전의 모든 주석과 하이라이트가 새 버전에도 적용됩니다.
- '버전 기록 보기'를 통해 버전 간 차이점을 확인합니다. 삭제된 내용은 빨강색 삭선으로, 추가된 내용은 파랑색 밑줄로 보입니다. 
- 특정 주석이 새 버전에서는 맞지 않게 되어, 해당 주석을 수정합니다. 또한 AI Agent에게 write 모드로 주석을 업데이트 하라고 지시합니다. 
- 유저는 드롭다운 위젯으로 이전 버전의 계약서도 확인 가능합니다.  

### 8. 프로젝트분석을 위한 증거자료 활용 [TODO]
- 모든 증거자료 정리가 완료된 후, '프로젝트분석' 탭으로 이동합니다.
- 프로젝트 목표를 "사기 혐의 무혐의 처분 받기"로 설정합니다.
- 주장 항목으로 "계약 이행 의사가 있었음", "금전적 어려움으로 일시적 이행 지연" 등을 추가합니다.
- 각 주장에 대해 'AI 근거자료 추천' 기능을 사용합니다.
- AI는 앞서 정리한 증거자료들을 분석하여 각 주장을 뒷받침할 수 있는 증거자료들을 자동으로 연결해줍니다.
- 일부 주장에 대해서는 증거가 부족하다는 AI의 피드백을 받고, 추가 증거 수집이 필요한 영역을 파악합니다.

## 시나리오 평가
본 시나리오는 증거자료 관리에 필요한 다양한 기능을 포함하고 있으나, 현재는 대부분의 기능이 구현되지 않은 상태입니다.

1. **증거자료 업로드 및 분류 [PASS]**
   - 기본적인 파일 업로드 및 폴더 생성, 태그 기능은 구현되어 있습니다.
   - 프로젝트 내에서 파일을 관리하는 기본 구조가 마련되어 있습니다.

2. **OCR 처리 및 텍스트 추출 [TODO]**
   - OCR 처리 및 임베딩 기능이 완전히 구현되지 않았습니다.
   - 자동 OCR 처리, 진행 상태 표시, 텍스트 추출 및 수정 기능이 필요합니다.
   - 필요 API: OCR 처리 API, 임베딩 생성 API, 텍스트 추출 및 수정 API

3. **PDF 주석 및 하이라이트 [TODO]**
   - PDF 문서에 대한 주석 및 하이라이트 기능이 구현되지 않았습니다.
   - 다양한 색상의 하이라이트, 주석 추가, 주석 목록 보기 및 내보내기 기능이 필요합니다.
   - 필요 API: PDF 주석 CRUD API, 하이라이트 CRUD API, 주석 내보내기 API

4. **증거자료 검색 및 필터링 [TODO]**
   - OCR 텍스트 기반 검색 및 관련도 계산 기능이 구현되지 않았습니다.
   - 태그 기반 필터링, 멀티탭 문서 열람 기능이 필요합니다.
   - 필요 API: 증거자료 검색 API, 관련도 계산 API, 태그 필터링 API

5. **AI Agent를 통한 증거자료 검색 [TODO]**
   - 자연어 쿼리를 통한 의미 기반 증거자료 검색 기능이 구현되지 않았습니다.
   - AI Agent의 ask/write 모드 구분 및 의도 파악 기능이 필요합니다.
   - 필요 API: 자연어 검색 API, 관련성 점수 계산 API, 검색 히스토리 API

6. **증거자료 인용 및 문서 연결 [TODO]**
   - 문서 작성 중 증거자료 인용 기능이 구현되지 않았습니다.
   - @ 입력을 통한 팝업 메뉴, 특정 부분 인용, 팝업 프리뷰 기능이 필요합니다.
   - 필요 API: 증거자료 인용 API, 문서 연결 API

7. **작성문서 버전 관리 [TODO]**
   - 증거자료의 버전 관리 기능이 구현되지 않았습니다.
   - 버전 간 차이점 표시, 주석 업데이트, 버전 전환 기능이 필요합니다.
   - 필요 API: 버전 생성 API, 버전 비교 API, 주석 마이그레이션 API

8. **프로젝트분석을 위한 증거자료 활용 [TODO]**
   - 프로젝트 목표 및 주장 관리, AI 근거자료 추천 기능이 구현되지 않았습니다.
   - 증거자료와 주장의 연결, 증거 부족 영역 식별 기능이 필요합니다.
   - 필요 API: 프로젝트 목표 관리 API, 주장 관리 API, AI 근거자료 추천 API

전반적으로 OCR 처리, PDF 주석, 검색, AI 활용, 버전 관리 등의 핵심 기능이 아직 구현되지 않았으며, 이를 위한 백엔드 API와 프론트엔드 UI 개발이 필요합니다. 증거자료 업로드와 기본 분류 기능만 현재 구현되어 있는 상태입니다. 